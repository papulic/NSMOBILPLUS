{% extends 'eprodaja/base.html' %}
{% block title %}Početna{% endblock %}
{% block content %}
{% load staticfiles %}

	<header id="header">
		<div class="header-bottom"><!--header-bottom-->
			<div class="container">
				<div class="row">
					<div class="col-sm-3">

					</div>
				</div>
			</div>
		</div><!--/header-bottom-->
	</header><!--/header-->
	
	<section id="slider"><!--slider-->
		<div class="container">
			<div class="row">
				<div class="col-sm-12">
					<div id="slider-carousel" class="carousel slide" data-ride="carousel">
						<ol class="carousel-indicators">
							<li data-target="#slider-carousel" data-slide-to="0" class="active"></li>
							<li data-target="#slider-carousel" data-slide-to="1"></li>
							<li data-target="#slider-carousel" data-slide-to="2"></li>
						</ol>
						
						<div class="carousel-inner">
							<div class="item active">
								<div class="col-sm-6">
									<h1><img class="stop jq" width="308" height="70" src="{%  static 'eprodaja/images/home/NSmobilPlusLogo.jpg' %}" alt="" /></h1>
									<h2>Prodaja opreme za mobilne telefone</h2>
									<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. </p>
									<button type="button" class="btn btn-default get">Pogledajte ponudu</button>
								</div>
								<div class="col-sm-6">
									<img src="{%  static 'eprodaja/images/home/oprema.jpg' %}" class="girl img-responsive" alt="" />
									<img src="{%  static 'eprodaja/images/home/pricing.png' %}"  class="pricing" alt="" />
								</div>
							</div>
							<div class="item">
								<div class="col-sm-6">
									<h1><img class="stop jq" width="308" height="70" src="{%  static 'eprodaja/images/home/NSmobilPlusLogo.jpg' %}" alt="" /></h1>
									<h2>Servis mobilnih telefona</h2>
									<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. </p>
									<button type="button" class="btn btn-default get">Pogledajte ponudu</button>
								</div>
								<div class="col-sm-6">
									<img src="{%  static 'eprodaja/images/home/servis.png' %}" class="girl img-responsive" alt="" />
									<img src="{%  static 'eprodaja/images/home/pricing.png' %}"  class="pricing" alt="" />
								</div>
							</div>
							
							<div class="item">
								<div class="col-sm-6">
									<h1><img class="stop jq" width="308" height="70" src="{%  static 'eprodaja/images/home/NSmobilPlusLogo.jpg' %}" alt="" /></h1>
									<h2>Prodaja mobilnih telefona</h2>
									<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. </p>
									<button type="button" class="btn btn-default get">Pogledajte ponudu</button>
								</div>
								<div class="col-sm-6">
									<img src="{%  static 'eprodaja/images/home/telefoni.jpg' %}" class="girl img-responsive" alt="" />
									<img src="{%  static 'eprodaja/images/home/pricing.png' %}" class="pricing" alt="" />
								</div>
							</div>
							
						</div>
						
						<a href="#slider-carousel" class="stop jq left control-carousel hidden-xs" data-slide="prev">
							<i class="fa fa-angle-left"></i>
						</a>
						<a href="#slider-carousel" class="stop jq right control-carousel hidden-xs" data-slide="next">
							<i class="fa fa-angle-right"></i>
						</a>
					</div>
					
				</div>
			</div>
		</div>
	</section><!--/slider-->
	
	<section>
		<div class="container">
			<div class="row">
				<div class="col-sm-3">
					<div class="left-sidebar">
						<h2>PRETRAGA</h2>
						<div class="panel-group category-products">
							<form id="main-contact-form" class="contact-form row">
								<div class="form-group col-md-6">
									<input type="text" name="pretraga_svih_artikala" class="form-control" required="required" placeholder="Pretraga..." title=" ">
								</div>
								<div class="form-group col-md-6">
									<buttom id="pretrazi_artikle" class="btn btn-primary pull-right">Pretraži</buttom>
								</div>

							</form>
						</div>
                        <h2>KATEGORIJE</h2>
                        <div class="panel-group category-products" id="accordian"><!--category-productsr-->

                            {% for kategorija in sve_kategorije %}
							<div class="panel panel-default">
								<div class="panel-heading">
									<h4 class="panel-title">
										{% if kategorija.podkategorije.all %}
										<a class="kategorija{{ kategorija.id }}" data-id="kategorija{{ kategorija.id }}" data-toggle="collapse" data-parent="#accordian" href="#{{ kategorija.id }}">
											<span class="badge pull-right"><i class="fa fa-plus"></i></span>
										{% else %}
										<a class="kategorija{{ kategorija.id }}" data-id="kategorija{{ kategorija.id }}" href="javascript:void(0)">
										{% endif %}
											{{ kategorija }}
										</a>
									</h4>
								</div>

								<div id="{{ kategorija.id }}" class="panel-collapse collapse">
									<div class="panel-body">
										<ul>
											{% if kategorija.podkategorije.all %}
                                            {% for podkategorija in kategorija.podkategorije.all %}
											<li>
												{% if kategorija.kategorija == "PUNJAČI" or kategorija.kategorija == "DATA-USB KABLOVI" or kategorija.kategorija == "FUTROLE"  %}
												<a class="podkategorija{{ podkategorija.id }}" data-id="podkategorija{{ podkategorija.id }}" data-toggle="collapse" href="#{{ kategorija.id }}{{ podkategorija.id }}">
													<span class="badge pull-right"><i class="fa fa-plus"></i></span>
												{% else %}
												<a class="podkategorija{{ podkategorija.id }}" data-id="podkategorija{{ podkategorija.id }}" href="javascript:void(0)">
												{% endif %}
													<b>{{ podkategorija.podkategorija }}</b>
												</a>
											</li>
											{% if kategorija.kategorija == "PUNJAČI" or kategorija.kategorija == "DATA-USB KABLOVI" %}
											<div id="{{ kategorija.id }}{{ podkategorija.id }}" class="collapse">
												<ul>
												{% for tip in tipovi %}
													<li><a data-id="tip{{ tip.id }}" href="javascript:void(0)">{{ tip.tip }}</a></li>
												{% endfor %}
												</ul>
											</div>
											{% endif %}
											{% if kategorija.kategorija == "FUTROLE" %}
											<div id="{{ kategorija.id }}{{ podkategorija.id }}" class="collapse">
												<ul>
												{% for brend in brendovi %}
													<li><a data-id="brend{{ brend.id }}" href="javascript:void(0)">{{ brend.brend }}</a></li>
												{% endfor %}
												</ul>
											</div>
											{% endif %}
											{% endfor %}
											{% endif %}

										</ul>
									</div>
								</div>
							</div>
                            {% endfor %}
						</div><!--/category-products-->
					</div>
				</div>
				
				<div class="col-sm-9 padding-right">
					<div class="recommended_items"><!--recommended_items-->
						<h2 class="title text-center">ARTIKLI</h2>
							<div id="filter_artikli" class="category-tab"><!--category-tab-->
                                <!--Ovo brise jquery filter-->
                                {% for artikal in random_artikli %}
								<div class="col-sm-4">
									<div class="product-image-wrapper">
										<div class="single-products">
											<div class="productinfo text-center">
												<a class="stop jq" href="artikal/{{ artikal.id }}">
												{% if artikal.slika %}
												<img src="{{ artikal.slika.url }}" alt="" />
												{% endif %}
												</a>
												<h2>{{ artikal.cena }} din</h2>
												<p>{{ artikal.opis }}</p>
                                                <button id="{{ artikal.id }}" class="btn btn-default add-to-cart" type="submit" value="U korpu"><i class="fa fa-shopping-cart input_span"></i> U korpu</button>
											</div>
										</div>
									</div>
								</div>
								{% endfor %}

							</div><!--/category-tab-->
						</div>
					{% if artikli_na_akciji %}
					<div class="recommended_items"><!--recommended_items-->
						<h2 class="title text-center">AKCIJA</h2>
						
						<div id="recommended-item-carousel" class="carousel slide" data-ride="carousel">
							<div class="carousel-inner">
								{% for artikal in artikli_na_akciji %}
								{% if forloop.counter0 == 0 %}
								<div class="item active">
								{% endif %}
								{% if forloop.counter0|divisibleby:3 and forloop.counter0 != 0 %}
								<div class="item">
								{% endif %}
									<div class="col-sm-4">
										<div class="product-image-wrapper">
											<div class="single-products">
												<div class="productinfo text-center">
													<a class="stop jq" href="artikal/{{ artikal.id }}">
													{% if artikal.slika %}
													<img src="{{ artikal.slika.url }}" alt="" />
													{% endif %}
													</a>
													<h2>{{ artikal.cena }}</h2>
													<p>{{ artikal.opis }}</p>
													<button id="{{ artikal.id }}" class="btn btn-default add-to-cart" type="submit" value="U korpu"><i class="fa fa-shopping-cart input_span"></i> U korpu</button>
												</div>
											</div>
										</div>
									</div>
								{% if forloop.counter0 == 2 %}
								</div>
								{% endif %}
								{% if forloop.counter|divisibleby:3 and forloop.counter0 > 4 %}
								</div>
								{% endif %}
								{% if forloop.last %}
								{% if forloop.counter|divisibleby:3 %}
								{% else %}
								{% if forloop.counter0 > 2  %}
								</div>
								{% endif %}
								{% endif %}
								{% endif %}
								{% endfor %}

							</div>
							 <a class="stop jq left recommended-item-control" href="#recommended-item-carousel" data-slide="prev">
								<i class="fa fa-angle-left"></i>
							  </a>
							  <a class="stop jq right recommended-item-control" href="#recommended-item-carousel" data-slide="next">
								<i class="fa fa-angle-right"></i>
							  </a>			
						</div>
					</div><!--/recommended_items-->
					{% endif %}
				</div>
			</div>
		</div>
	</section>
{% endblock %}
{% block jquery %}

    //$(":button").click(function() {
    jQuery(document.body).on('click', ':button', function() {
        //console.log(this.id);
        if(this.id != "pretrazi_artikle"){
            var artikal_id = this.id;
            $.ajax({
                context: this,
                url: '/dodaj_artikal/',
                data: {
                       'artikal_id': artikal_id
                },
                dataType: 'json',
                success: function (data) {
                    if (data.error) {
                        window.location = '/logovanje/';
                    } else{
                        $('html, body').animate({
                            'scrollTop' : $("#korpa").position().top
                        });

                        var itemImg = $(this).parent().find('img').eq(0);
                        flyToElement($(itemImg), $('#korpa'));
                        $("#korpa").html(data.proizvoda_u_korpi);
                        $(this).hide();
                    }
                }
            });
        }
    });
    // class="stop jq" dodato svugde na index i base na elemente "a", da se ne dobija greska ako nije pretraga!!!
    $('a:not([class^="stop jq"])').on("click",function(){
		var kategorija_ili_podkategorija =  $(this).data("id");
		//var parent = $(this).closest('div').attr('id');
		//var kategorija = $('html').find('a[class^="kategorija"]').data("id");
		var kategorija = $(this).parents().addBack().prevAll().find('a[class^="kategorija"]').addBack('a[class^="kategorija"]').last().data("id");
		var podkategorija = $(this).parents().addBack().prevAll().find('a[class^="podkategorija"]').addBack('a[class^="podkategorija"]').last().data("id");
		//console.log(kategorija);
		//console.log(podkategorija);
		$.ajax({
			context: this,
			url: '/filter/',
			data: {
				   'kategorija_ili_podkategorija': kategorija_ili_podkategorija,
				   'kategorija': kategorija,
				   'podkategorija': podkategorija
			},
			dataType: 'json',
			success: function (data) {
				$("#filter_artikli").html("");
				if (data.length > 0) {
					$("#filter_artikli").css('paddingBottom', '0px');
					for (i = 0; i < data.length; i++){
						var line = '<div class="col-sm-3"> \
									<div class="product-image-wrapper"> \
										<div class="single-products"> \
											<div class="productinfo text-center"> \
												<a class="stop jq" href="artikal/'+data[i].id+'"> \
												<img src="/media/' + data[i].slika + '" alt="" /> \
												</a> \
												<h2>' + data[i].cena + 'din</h2> \
												<p>' + data[i].opis + '</p> \
												<button id="' + data[i].id + '" class="btn btn-default add-to-cart" type="submit" value="U korpu"><i class="fa fa-shopping-cart input_span"></i> U korpu</button> \
											</div> \
										</div> \
									</div> \
								</div>';
						$("#filter_artikli").append(line);
					}
				}
				else{
					$("#filter_artikli").css('paddingBottom', '450px');
					var line = '<h4>Trenutno nema proizvoda u ovoj sekciji</h4>';
					$("#filter_artikli").append(line);
				}
			}
        });
    });

	$('#main-contact-form').submit(function (e) {
		e.preventDefault();
		$("#pretrazi_artikle").click();
	});
    $('#pretrazi_artikle').on("click",function(){
    	var pretraga = $('input[name=pretraga_svih_artikala]').val();
    	$('input[name=pretraga_svih_artikala]').val("");
    	$.ajax({
			context: this,
			url: '/pretraga/',
			data: {
				   'pretraga': pretraga,
			},
			dataType: 'json',
			success: function (data) {
				$("#filter_artikli").html("");
				if (data.length > 0) {
					for (i = 0; i < data.length; i++){
						var line = '<div class="col-sm-3"> \
									<div class="product-image-wrapper"> \
										<div class="single-products"> \
											<div class="productinfo text-center"> \
												<a class="stop jq" href="artikal/'+data[i].id+'"> \
												<img src="/media/' + data[i].slika + '" alt="" /> \
												</a> \
												<h2>' + data[i].cena + 'din</h2> \
												<p>' + data[i].opis + '</p> \
												<button id="' + data[i].id + '" class="btn btn-default add-to-cart" type="submit" value="U korpu"><i class="fa fa-shopping-cart input_span"></i> U korpu</button> \
											</div> \
										</div> \
									</div> \
								</div>';
						$("#filter_artikli").append(line);
					}

				}
				else{
					var line = '<h4>Trenutno nema proizvoda za traženi kriterijum</h4>';
					$("#filter_artikli").append(line);
				}
			}
        });
    });

{% endblock %}